<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pro Invoice Generator – ToolNest</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="../style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
#invoicePreview{
background:white;
color:black;
padding:20px;
}
#invoicePreview img{
max-width:120px;
margin-bottom:10px;
}
table{
width:100%;
border-collapse:collapse;
}
table,th,td{
border:1px solid #ccc;
padding:6px;
text-align:center;
}
button{
margin:5px 0;
}
</style>

</head>
<body>

<div id="header"></div>

<section class="mini-hero">
<a href="../index.html">⬅ Back to Home</a>
<h1>Professional Invoice Generator</h1>
</section>

<section class="container">
<div class="tool-box">

<h3>Company Details</h3>
<input id="bizName" placeholder="Business Name">
<input id="bizEmail" placeholder="Business Email">
<input id="bizGST" placeholder="GST Number (Optional)">
<label>Upload Logo</label>
<input type="file" id="logoUpload" accept="image/*">

<h3>Client Details</h3>
<input id="clientName" placeholder="Client Name">
<input id="clientEmail" placeholder="Client Email">

<h3>Invoice Info</h3>
<label>Invoice Number (Leave blank for auto)</label>
<input id="invoiceNo" placeholder="Invoice Number">
<input type="date" id="invoiceDate">

<h3>Items</h3>
<table id="itemsTable">
<tr>
<th>Item</th>
<th>Qty</th>
<th>Price</th>
<th>Total</th>
<th></th>
</tr>
</table>

<button onclick="addItem()">+ Add Item</button>

<br><br>

<label>Discount %</label>
<input type="number" id="discountPercent" value="0">

<label>GST %</label>
<input type="number" id="gstPercent" value="0">

<br><br>

<button onclick="generateInvoice()">Generate Invoice</button>
<button onclick="downloadPDF()">Download PDF</button>
<button onclick="printInvoice()">Print</button>
<button onclick="emailInvoice()">Email Invoice</button>

<h3>Saved Invoice History</h3>
<select id="historyList" onchange="loadInvoice(this.value)">
<option value="">Select Saved Invoice</option>
</select>

</div>
</section>

<section class="container">
<div id="invoicePreview" style="display:none">
<img id="previewLogo">
<h2>INVOICE</h2>

<p><strong id="pBiz"></strong></p>
<p id="pBizEmail"></p>
<p id="pGST" style="display:none"></p>

<hr>

<p><strong>Billed To:</strong> <span id="pClient"></span></p>
<p id="pClientEmail"></p>
<p>Invoice #: <span id="pInvNo"></span></p>
<p>Date: <span id="pInvDate"></span></p>

<table>
<thead>
<tr>
<th>Item</th>
<th>Qty</th>
<th>Price</th>
<th>Total</th>
</tr>
</thead>
<tbody id="previewItems"></tbody>
</table>

<hr>

<p>Subtotal: ₹ <span id="subTotal"></span></p>
<p id="discountRow" style="display:none">Discount: ₹ <span id="discountAmount"></span></p>
<p id="gstRow" style="display:none">GST: ₹ <span id="gstAmount"></span></p>
<h3>Grand Total: ₹ <span id="grandTotal"></span></h3>

</div>
</section>

<script>

let logoBase64="";

document.getElementById("logoUpload").addEventListener("change",function(e){
const reader=new FileReader();
reader.onload=function(){
logoBase64=reader.result;
document.getElementById("previewLogo").src=logoBase64;
};
reader.readAsDataURL(e.target.files[0]);
});

function addItem(){
const row=document.createElement("tr");
row.innerHTML=`
<td><input></td>
<td><input type="number" value="1" onchange="calc()"></td>
<td><input type="number" value="0" onchange="calc()"></td>
<td class="lineTotal">0</td>
<td><button onclick="this.parentElement.parentElement.remove();calc()">❌</button></td>
`;
itemsTable.appendChild(row);
}
addItem();

function calc(){
let subtotal=0;
for(let i=1;i<itemsTable.rows.length;i++){
let q=itemsTable.rows[i].cells[1].children[0].value||0;
let p=itemsTable.rows[i].cells[2].children[0].value||0;
let t=q*p;
itemsTable.rows[i].querySelector(".lineTotal").innerText=t.toFixed(2);
subtotal+=t;
}
return subtotal;
}

function generateInvoice(){

document.getElementById("invoicePreview").style.display="block";

let invNo=invoiceNo.value.trim();
if(!invNo){
invNo="INV-"+Date.now();
invoiceNo.value=invNo;
}

pBiz.innerText=bizName.value;
pBizEmail.innerText=bizEmail.value;
pClient.innerText=clientName.value;
pClientEmail.innerText=clientEmail.value;
pInvNo.innerText=invNo;
pInvDate.innerText=invoiceDate.value;

if(bizGST.value.trim()){
pGST.style.display="block";
pGST.innerText="GST No: "+bizGST.value;
}else{
pGST.style.display="none";
}

previewItems.innerHTML="";
let subtotal=calc();

for(let i=1;i<itemsTable.rows.length;i++){
previewItems.innerHTML+=`
<tr>
<td>${itemsTable.rows[i].cells[0].children[0].value}</td>
<td>${itemsTable.rows[i].cells[1].children[0].value}</td>
<td>${itemsTable.rows[i].cells[2].children[0].value}</td>
<td>${itemsTable.rows[i].querySelector(".lineTotal").innerText}</td>
</tr>`;
}

let discount=subtotal*(discountPercent.value||0)/100;
let afterDiscount=subtotal-discount;
let gst=afterDiscount*(gstPercent.value||0)/100;
let grand=afterDiscount+gst;

subTotal.innerText=subtotal.toFixed(2);

discountRow.style.display=discount>0?"block":"none";
discountAmount.innerText=discount.toFixed(2);

gstRow.style.display=gst>0?"block":"none";
gstAmount.innerText=gst.toFixed(2);

grandTotal.innerText=grand.toFixed(2);

saveInvoice(invNo);
}

function downloadPDF(){
html2pdf().from(invoicePreview).save("invoice.pdf");
}

function printInvoice(){
let w=window.open("");
w.document.write(invoicePreview.innerHTML);
w.print();
w.close();
}

function emailInvoice(){
let subject="Invoice "+pInvNo.innerText;
let body="Dear "+pClient.innerText+",%0D%0APlease find your invoice attached.";
window.location.href=`mailto:${pClientEmail.innerText}?subject=${subject}&body=${body}`;
}

function saveInvoice(id){
let history=JSON.parse(localStorage.getItem("invoices")||"{}");
history[id]=invoicePreview.innerHTML;
localStorage.setItem("invoices",JSON.stringify(history));
loadHistory();
}

function loadHistory(){
let history=JSON.parse(localStorage.getItem("invoices")||"{}");
historyList.innerHTML='<option value="">Select Saved Invoice</option>';
for(let key in history){
historyList.innerHTML+=`<option value="${key}">${key}</option>`;
}
}
loadHistory();

function loadInvoice(id){
if(!id) return;
let history=JSON.parse(localStorage.getItem("invoices")||"{}");
invoicePreview.innerHTML=history[id];
invoicePreview.style.display="block";
}

</script>

</body>
</html>
