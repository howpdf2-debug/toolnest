<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Invoice Generator – ToolNest</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="../style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>

<body class="tool-invoice">

<div id="header"></div>
<!-- HERO -->
<section class="mini-hero">
  <div class="hero-top">
    <a href="../index.html" class="back-home">⬅ Back to Home</a>
  </div>

  <!-- TOOL BOX -->
<section class="container">
  <div class="tool-box colorful green">


<h2>Invoice Details</h2>

<h3>Business Details</h3>
<input id="bizName" placeholder="Business Name">
<input id="bizEmail" placeholder="Business Email">
<input id="bizGST" placeholder="GST Number (Optional)">

<h3>Client Details</h3>
<input id="clientName" placeholder="Client Name">
<input id="clientEmail" placeholder="Client Email">

<h3>Invoice Info</h3>
<input id="invoiceNo" placeholder="Invoice Number">
<input type="date" id="invoiceDate">

<h3>Invoice Items</h3>

<table id="itemsTable" style="width:100%;border-collapse:collapse">
<tr>
<th>Item</th>
<th>Qty</th>
<th>Price</th>
<th>Total</th>
<th></th>
</tr>
</table>

<button onclick="addItem()">+ Add Item</button>

<br><br>

<label>Discount % (Optional)</label>
<input type="number" id="discountPercent" value="0">

<label>GST % (Optional)</label>
<input type="number" id="gstPercent" value="0">

<br><br>

<button onclick="generateInvoice()">Generate Invoice</button>
<button onclick="downloadPDF()">Download PDF</button>

</div>
</section>

<!-- PREVIEW -->
<section class="container">
<div class="tool-box" id="invoicePreview" style="display:none;background:white;color:black">

<h2>INVOICE</h2>

<p><strong id="pBiz"></strong></p>
<p id="pBizEmail"></p>
<p id="pGST" style="display:none"></p>

<hr>

<p><strong>Billed To:</strong> <span id="pClient"></span></p>
<p id="pClientEmail"></p>

<p>Invoice #: <span id="pInvNo"></span></p>
<p>Date: <span id="pInvDate"></span></p>

<table style="width:100%;margin-top:20px;border-collapse:collapse" border="1">
<thead>
<tr>
<th>Item</th>
<th>Qty</th>
<th>Price</th>
<th>Total</th>
</tr>
</thead>
<tbody id="previewItems"></tbody>
</table>

<hr>

<p>Subtotal: ₹ <span id="subTotal"></span></p>
<p id="discountRow" style="display:none">Discount: ₹ <span id="discountAmount"></span></p>
<p id="gstRow" style="display:none">GST: ₹ <span id="gstAmount"></span></p>
<h3>Grand Total: ₹ <span id="grandTotal"></span></h3>

</div>
</section>

<div id="footer"></div>

<script src="../includes/include.js"></script>
<script src="../darkmode.js"></script>

<script>

function addItem(){
  const row=document.createElement("tr");
  row.innerHTML=`
    <td><input></td>
    <td><input type="number" value="1" onchange="calc()"></td>
    <td><input type="number" value="0" onchange="calc()"></td>
    <td class="lineTotal">0</td>
    <td><button onclick="this.parentElement.parentElement.remove();calc()">❌</button></td>
  `;
  document.getElementById("itemsTable").appendChild(row);
}
addItem();

function calc(){
  let subtotal=0;
  const rows=document.getElementById("itemsTable").rows;

  for(let i=1;i<rows.length;i++){
    const q=rows[i].cells[1].children[0].value || 0;
    const p=rows[i].cells[2].children[0].value || 0;
    const t=q*p;
    rows[i].querySelector(".lineTotal").innerText=t.toFixed(2);
    subtotal+=t;
  }
  return subtotal;
}

function generateInvoice(){

  document.getElementById("invoicePreview").style.display="block";

  pBiz.innerText=bizName.value;
  pBizEmail.innerText=bizEmail.value;
  pClient.innerText=clientName.value;
  pClientEmail.innerText=clientEmail.value;
  pInvNo.innerText=invoiceNo.value;
  pInvDate.innerText=invoiceDate.value;

  if(bizGST.value.trim()!==""){
    pGST.style.display="block";
    pGST.innerText="GST No: "+bizGST.value;
  }else{
    pGST.style.display="none";
  }

  previewItems.innerHTML="";
  let subtotal=calc();

  const rows=document.getElementById("itemsTable").rows;

  for(let i=1;i<rows.length;i++){
    previewItems.innerHTML+=`
      <tr>
        <td>${rows[i].cells[0].children[0].value}</td>
        <td>${rows[i].cells[1].children[0].value}</td>
        <td>${rows[i].cells[2].children[0].value}</td>
        <td>${rows[i].querySelector(".lineTotal").innerText}</td>
      </tr>`;
  }

  const discountP=Number(discountPercent.value)||0;
  const gstP=Number(gstPercent.value)||0;

  const discountVal=subtotal*discountP/100;
  const afterDiscount=subtotal-discountVal;
  const gstVal=afterDiscount*gstP/100;
  const grand=afterDiscount+gstVal;

  subTotal.innerText=subtotal.toFixed(2);

  if(discountP>0){
    discountRow.style.display="block";
    discountAmount.innerText=discountVal.toFixed(2);
  }else{
    discountRow.style.display="none";
  }

  if(gstP>0){
    gstRow.style.display="block";
    gstAmount.innerText=gstVal.toFixed(2);
  }else{
    gstRow.style.display="none";
  }

  grandTotal.innerText=grand.toFixed(2);
}

function downloadPDF(){

  const element=document.getElementById("invoicePreview");

  html2pdf()
  .set({
    margin:10,
    filename:'toolnest-invoice.pdf',
    image:{type:'jpeg',quality:0.98},
    html2canvas:{scale:2},
    jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}
  })
  .from(element)
  .save();
}

</script>

</body>
</html>
